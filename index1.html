<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Integration with WIMS</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { margin:0; }
        #map { height: 100vh; width: 100%; }
        #panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #ffffffcc;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            z-index: 1000;
            width: 280px;
            font-family: Arial, sans-serif;
        }

        #panel h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #004080;
            text-align: center;
        }

        #panel button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 12px 10px;
            font-size: 14px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 10px;
            cursor: default;
            text-align: left;
            transition: background 0.3s, box-shadow 0.3s;
        }

        #panel button:hover {
            background-color: #f0f8ff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #submitButton {
            background-color: #007b00;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
        }

        #backButton {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #004080;
            color: #fff;
            padding: 8px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>

<div id="map"></div>

<div id="panel">
    <h2>Leaflet Integration with WIMS</h2>
    <button id="stateBtn">State: -</button>
    <button id="districtBtn">District: -</button>
    <button id="tehsilBtn">Tehsil: -</button>
    <button id="villageBtn">Village: -</button>
    <button id="latlngBtn">Lat: - , Lng: -</button>
    <button id="submitButton">âœ” Submit</button>
</div>

<div id="backButton">ðŸ”™ Back</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/esri-leaflet"></script>

<script>
    var map = L.map('map').setView([23.5, 80], 5);

    L.esri.basemapLayer('Imagery').addTo(map);
    L.esri.basemapLayer('ImageryLabels').addTo(map);

    const fsUrl = 'https://arc.indiawris.gov.in/server/rest/services/Common/Administrative_WRP/FeatureServer';
    const stateLayerUrl = fsUrl + '/3';
    const districtLayerUrl = fsUrl + '/4';
    const tehsilLayerUrl = fsUrl + '/5';
    const villageLayerUrl = fsUrl + '/6';

    var stateLayer, districtLayer, tehsilLayer, villageLayer;
    var selectedState = '-', selectedDistrict = '-', selectedTehsil = '-', selectedVillage = '-';
    var currentLevel = 'state';
    var lastBounds = null;
    var selectedLatLng = null;

    function toDMS(deg, type) {
        var d = Math.floor(Math.abs(deg));
        var m = Math.floor((Math.abs(deg) - d) * 60);
        var s = (((Math.abs(deg) - d) * 60 - m) * 60).toFixed(2);
        var dir = type === 'lat' ? (deg >= 0 ? 'N' : 'S') : (deg >= 0 ? 'E' : 'W');
        return d + "Â° " + m + "' " + s + "\" " + dir;
    }

    function loadStates() {
        removeAllLayers();
        stateLayer = L.esri.featureLayer({
            url: stateLayerUrl,
            style: { color: '#3333cc', weight: 1, fillOpacity: 0.4, fillColor: '#99ccff' },
            onEachFeature: function(feature, layer) {
                layer.on('click', function() {
                    selectedState = feature.properties.state;
                    selectedDistrict = '-';
                    selectedTehsil = '-';
                    selectedVillage = '-';
                    selectedLatLng = null;
                    updatePanel();
                    loadDistricts(selectedState, layer.getBounds());
                });
            }
        }).addTo(map);
        currentLevel = 'state';
        updatePanel();
        hideBack();
        hideSubmit();
    }

    function loadDistricts(stateName, bounds) {
        removeAllLayers();
        districtLayer = L.esri.featureLayer({
            url: districtLayerUrl,
            where: "state='" + stateName + "'",
            style: { color: '#004080', weight: 0.8, fillOpacity: 0.3, fillColor: '#66b2ff' },
            onEachFeature: function(feature, layer) {
                layer.on('click', function() {
                    selectedDistrict = feature.properties.district;
                    selectedTehsil = '-';
                    selectedVillage = '-';
                    selectedLatLng = null;
                    updatePanel();
                    loadTehsils(selectedDistrict, layer.getBounds());
                });
            }
        }).addTo(map);
        map.fitBounds(bounds);
        lastBounds = bounds;
        currentLevel = 'district';
        updatePanel();
        showBack();
        hideSubmit();
    }

    function loadTehsils(districtName, bounds) {
        removeAllLayers();
        tehsilLayer = L.esri.featureLayer({
            url: tehsilLayerUrl,
            where: "district='" + districtName + "'",
            style: { color: '#006600', weight: 0.8, fillOpacity: 0.3, fillColor: '#99e699' },
            onEachFeature: function(feature, layer) {
                layer.on('click', function() {
                    selectedTehsil = feature.properties.subdistrict;
                    selectedVillage = '-';
                    selectedLatLng = null;
                    updatePanel();
                    loadVillages(selectedTehsil, layer.getBounds());
                });
            }
        }).addTo(map);
        map.fitBounds(bounds);
        lastBounds = bounds;
        currentLevel = 'tehsil';
        updatePanel();
        showBack();
        hideSubmit();
    }

    function loadVillages(tehsilName, bounds) {
        removeAllLayers();
        villageLayer = L.esri.featureLayer({
            url: villageLayerUrl,
            where: "subdistrict='" + tehsilName + "'",
            style: { color: '#800000', weight: 0.8, fillOpacity: 0.3, fillColor: '#ffcccc' },
            onEachFeature: function(feature, layer) {
                layer.on('click', function(e) {
                    selectedVillage = feature.properties.village;
                    selectedLatLng = e.latlng;
                    updatePanel(e.latlng);
                    showSubmit();
                });
            }
        }).addTo(map);
        map.fitBounds(bounds);
        lastBounds = bounds;
        currentLevel = 'village';
        updatePanel();
        showBack();
    }

    function removeAllLayers() {
        if (stateLayer) map.removeLayer(stateLayer);
        if (districtLayer) map.removeLayer(districtLayer);
        if (tehsilLayer) map.removeLayer(tehsilLayer);
        if (villageLayer) map.removeLayer(villageLayer);
    }

    function updatePanel(latlng) {
        document.getElementById('stateBtn').textContent = 'State: ' + selectedState;
        document.getElementById('districtBtn').textContent = 'District: ' + selectedDistrict;
        document.getElementById('tehsilBtn').textContent = 'Tehsil: ' + selectedTehsil;
        document.getElementById('villageBtn').textContent = 'Village: ' + selectedVillage;
        if (latlng || selectedLatLng) {
            var point = latlng || selectedLatLng;
            document.getElementById('latlngBtn').textContent = 'Lat: ' + toDMS(point.lat, 'lat') + ' , Lng: ' + toDMS(point.lng, 'lng');
        } else {
            document.getElementById('latlngBtn').textContent = 'Lat: - , Lng: -';
        }
    }

    function showBack() {
        document.getElementById('backButton').style.display = 'block';
    }

    function hideBack() {
        document.getElementById('backButton').style.display = 'none';
    }

    function showSubmit() {
        document.getElementById('submitButton').style.display = 'block';
    }

    function hideSubmit() {
        document.getElementById('submitButton').style.display = 'none';
    }

    document.getElementById('backButton').addEventListener('click', function() {
        if (currentLevel === 'village') {
            loadTehsils(selectedDistrict, lastBounds);
        } else if (currentLevel === 'tehsil') {
            loadDistricts(selectedState, lastBounds);
        } else if (currentLevel === 'district') {
            loadStates();
        }
    });

    document.getElementById('submitButton').addEventListener('click', function() {
        var dmsLat = toDMS(selectedLatLng.lat, 'lat');
        var dmsLng = toDMS(selectedLatLng.lng, 'lng');
        alert("âœ” Submitted:\n\nState: " + selectedState + "\nDistrict: " + selectedDistrict + "\nTehsil: " + selectedTehsil + "\nVillage: " + selectedVillage + "\nLatLng: " + dmsLat + ", " + dmsLng);
    });

    loadStates();
</script>

</body>
</html>

















